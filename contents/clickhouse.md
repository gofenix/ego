---
date: "2019-10-12T06:48:01.338Z"
title: clickhouse
---

# ClickHouse

ClickHouse 是一个用于联机分析（Online Analytical Processing：OLAP）的列式数据库管理系统(DBMS)。通过使用 OLAP 工具，用户能够从多个角度交互地分析多维数据。

OLAP 由三个基本的分析操作组成：上卷（roll-up）、钻取（drill-down）、切片（slicing）和切块（dicing）。

- 上卷（roll-up）：涉及可以在一个或多个维度中累积和计算的数据的聚合。例如，所有的销售办事处汇总到销售部门，以预测销售趋势。

- 钻取（drill-down）：是一种允许用户浏览详细信息的技术。例如，用户可以查看组成一个地区销售额的单个产品的销售额。

- 切片（slicing）和切块（dicing）：用户可以从 OLAP 多维数据集中取出（切片）一组特定的数据，并从不同的角度查看（切块）切片。这些角度有时被称为维度（例如按销售人员、按日期、按客户、按产品或按地区查看相同的销售情况等）。

传统行式数据库中，处于同一行中的数据总是被物理的存在一起。列式数据库总是将同一列的数据存储在一起，不同列的数据分开存储。

行式数据库：mysql，pg

列式数据库：vertica，druid


## OLAP的关键特征

- 大多是读请求
- 数据总是以相当大的批（>1000w）进行写入
- 不修改已经添加的数据
- 每次查询都从数据库中读取大量的行，但是同时又仅需要少量的列
- 宽表，即每个表包含大量的列
- 较少的查询（通常每台服务器每秒数百个查询或更少）
- 对于简单的查询，允许延迟大约50ms
- 列中的数据相对较小：数字和短字符串
- 处理单个查询时需要高吞吐量（每个服务器每秒高达数十亿行）
- 事务不是必须的
- 对数据一致性要求低
- 每一个查询除了一个大表外都很小
- 查询结果明显小于数据源，换句话说，数据被过滤或者聚合之后能够被放在单台服务器的内存中


## 列式数据库更适合OLAP场景

### Input/Output

1. 分析类的查询，通常只需要读取表的一小部分列。
2. 数据总是打包成批量读取，列压缩更容易
3. IO降低了

### CPU
由于执行一个查询需要处理大量的行，因此在整个向量上执行所有操作将比在每一行上执行所有操作更加高效。同时这将有助于实现一个几乎没有调用成本的查询引擎。

1. 向量引擎
2. 代码生成

为了提高CPU效率，查询语言必须是声明型的(SQL或MDX)， 或者至少一个向量(J，K)。 查询应该只包含隐式循环，允许进行优化。

# clickhouse的独特功能

## 真正的列式数据库管理系统

- 