<html>
    <head>
        <title> 
            hugo-github-action
        </title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.1.0/build/styles/default.min.css"
    />
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.1.0/build/highlight.min.js"></script>

    <script>
      hljs.highlightAll();
    </script>

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      .markdown-body {
        box-sizing: border-box;
        min-width: 200px;
        max-width: 980px;
        margin: 0 auto;
        padding: 45px;
      }

      @media (max-width: 767px) {
        .markdown-body {
          padding: 15px;
        }
      }
    </style>
    </head>

    <body>
        <div>
            <article class="markdown-body"> 
                <hr class="thin" />
<p>
title: “Github Action自动部署blog”
date: 2021-02-18T13:20:11+08:00
draft: false
TocOpen: false
draft: false
hidemeta: false
comments: false
description: “Desc Text.”
disableHLJS: true
disableShare: true
disableHLJS: false</p>
<hr class="thin" />
<p>
之前我采用的方式是两个github repo的方式： </p>
<p>
一个叫hugo-blog，用于存放blog的源文件</p>
<p>
一个叫zhenfeng-zhu.github.io，用于存放生成之后的文件</p>
<p>
然后通过写一个shell脚本，将生成之后的文件推向zhenfeng-zhu.github.io仓库中，同时将blog的源文件也做了一个backup。后来使用了一个github action的方式，
就不用在两个仓库中进行折腾，一切都由github action来做了。</p>
<h1>
方案</h1>
<h2>
设置workflow</h2>
<p>
首先创建一个.github/workflows/gh-pages.yml</p>
<pre><code class="yaml">name: github pages

on:
  push:
    branches:
      - main  # Set a branch to deploy

jobs:
  deploy:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v2
        with:
          submodules: true  # Fetch Hugo themes (true OR recursive)
          fetch-depth: 0    # Fetch all history for .GitInfo and .Lastmod

      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: &#39;latest&#39;
          # extended: true

      - name: Build
        run: hugo --minify

      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public</code></pre>
<p>
我们看下这个workflow的步骤：</p>
<ol>
  <li>
    <p>
name就是github pages    </p>
  </li>
  <li>
    <p>
on的意思代表，是什么行为会触发这个action的构建。
这里我们设置的是当push到main分支的时候进行构建。    </p>
  </li>
  <li>
    <p>
jobs就是具体的工作，这里指定了几个步骤：    </p>
    <ul>
      <li>
首先是在Ubuntu 18.04下进行构建      </li>
      <li>
这些步骤都是用的actions/checkout@v2模板进行，拉取submodules。      </li>
      <li>
setup hugo：采用的是peaceiris/actions-hugo@v2模板      </li>
      <li>
build：简单的hugo命令      </li>
      <li>
deploy：采用peaceiris/actions-gh-pages@v3方式，把自己的github token也配置上。具体可以点进去看下这个步骤做了什么操作。      </li>
    </ul>
  </li>
</ol>
<p>
然后把博客的源文件，放在main分支里，当我们push之后，就会发现出现了一个gh-pages分支。</p>
<h2>
设置github pages</h2>
<p>
打开该repo的settings，选到GitHub Pages。</p>
<p>
我们选择分支是gh-pages即可。</p>

            </article>
        </div>
    </body>
</html>

    