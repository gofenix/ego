<html>
    <head>
        <title> 
            go进阶
        </title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.1.0/build/styles/default.min.css"
    />
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.1.0/build/highlight.min.js"></script>

    <script>
      hljs.highlightAll();
    </script>

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      .markdown-body {
        box-sizing: border-box;
        min-width: 200px;
        max-width: 980px;
        margin: 0 auto;
        padding: 45px;
      }

      @media (max-width: 767px) {
        .markdown-body {
          padding: 15px;
        }
      }
    </style>
    </head>

    <body>
        <div>
            <article class="markdown-body"> 
                <hr class="thin" />
<p>
date: “2019-08-26T06:53:32.176Z”
title: go进阶</p>
<hr class="thin" />
<h1>
Diagnostics</h1>
<p>
go提供了一系列诊断逻辑和性能问题的工具。</p>
<ul>
  <li>
profiling分析  </li>
  <li>
tracing跟踪  </li>
  <li>
debuging调试  </li>
  <li>
运行时统计信息和事件  </li>
</ul>
<h2>
Profiling</h2>
<p>
profiling信息可以在go test或者net/http/pprof包的时候使用。</p>
<p>
runtime/pprof包有：</p>
<ul>
  <li>
cpu    <ul>
      <li>
主动消费cpu周期所花费的时间，不包括睡眠或者io等待      </li>
    </ul>
  </li>
  <li>
heap    <ul>
      <li>
报告内存分配采样；      </li>
      <li>
当前或历史内存使用状况      </li>
      <li>
检测内存泄露      </li>
    </ul>
  </li>
  <li>
threadcreate    <ul>
      <li>
报告创建新的系统线程      </li>
    </ul>
  </li>
  <li>
goroutine    <ul>
      <li>
当前所有协程的堆栈跟踪      </li>
    </ul>
  </li>
  <li>
block    <ul>
      <li>
显示goroutine阻塞等待同步原语的位置。      </li>
      <li>
默认不开启，使用runtime.SetBlockProfileRate启用      </li>
    </ul>
  </li>
  <li>
mutex    <ul>
      <li>
报告锁竞争。      </li>
      <li>
如果认为自己的程序因为互斥锁导致cpu不能充分利用的时候，使用这个。      </li>
      <li>
默认也是不开启，使用 runtime.SetMutexProfileFraction 启用。      </li>
    </ul>
  </li>
</ul>
<p>
其他可用的的性能分析工具</p>
<p>
Linux使用<a href="https://perf.wiki.kernel.org/index.php/Tutorial">https://perf.wiki.kernel.org/index.php/Tutorial</a>，perf可以分析cgo/SWIG代码和系统内核。</p>
<p>
mac上使用 <a href="https://developer.apple.com/library/content/documentation/DeveloperTools/Conceptual/InstrumentsUserGuide/">https://developer.apple.com/library/content/documentation/DeveloperTools/Conceptual/InstrumentsUserGuide/</a> 就足够了。</p>
<p>
分析线上处于生产状态服务</p>
<p>
在生产上分析程序也是没问题的，但是开启某些指标会增加成本。</p>
<p>
可视化分析数据</p>
<p>
go 提供了很多可视化的工具，参考<a href="https://blog.golang.org/profiling-go-programs">https://blog.golang.org/profiling-go-programs</a></p>
<p>
也可以创建自定义的profil文件：参考<a href="https://golang.org/pkg/runtime/pprof/#Profile">https://golang.org/pkg/runtime/pprof/#Profile</a></p>
<p>
也可以自定义修改pprof程序监听的端口和路径，参考：</p>
<pre><code class="go">package main

import (
    &quot;log&quot;
    &quot;net/http&quot;
    &quot;net/http/pprof&quot;
)

func main() {
    mux := http.NewServeMux()
    mux.HandleFunc(&quot;/custom_debug_path/profile&quot;, pprof.Profile)
    log.Fatal(http.ListenAndServe(&quot;:7777&quot;, mux))
}</code></pre>

            </article>
        </div>
    </body>
</html>

    