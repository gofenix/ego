<html>
    <head>
        <title> 
            node的redis实战
        </title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.1.0/build/styles/default.min.css"
    />
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.1.0/build/highlight.min.js"></script>

    <script>
      hljs.highlightAll();
    </script>

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      .markdown-body {
        box-sizing: border-box;
        min-width: 200px;
        max-width: 980px;
        margin: 0 auto;
        padding: 45px;
      }

      @media (max-width: 767px) {
        .markdown-body {
          padding: 15px;
        }
      }
    </style>
    </head>

    <body>
        <div>
            <article class="markdown-body"> 
                <hr class="thin" />
<p>
date: “2018-04-13 10:00:12”
title: node的redis实战</p>
<hr class="thin" />
<h1>
Node.js Redis客户端模块</h1>
<p>
为了追新，这里我使用的yarn，毕竟我是HDD（面向热点编程）编程实践者。</p>
<p>
模块安装</p>
<pre><code>yarn add redis</code></pre>
<p>
模块使用实例</p>
<pre><code>const redis = require(&#39;redis&#39;)
const client = redis.createClient(&#39;6379&#39;, &#39;127.0.0.1&#39;)

client.on(&quot;error&quot;, function (err) {
    console.log(&quot;Error &quot; + err);
});

client.set(&quot;string key&quot;, &quot;string val&quot;, redis.print);
client.hset(&quot;hash key&quot;, &quot;hashtest 1&quot;, &quot;some value&quot;, redis.print);
client.hset([&quot;hash key&quot;, &quot;hashtest 2&quot;, &quot;some other value&quot;], redis.print);
client.hkeys(&quot;hash key&quot;, function (err, replies) {
    console.log(replies.length + &quot; replies:&quot;);
    replies.forEach(function (reply, i) {
        console.log(&quot;    &quot; + i + &quot;: &quot; + reply);
    });
    client.quit();
});</code></pre>
<p>
输出的结果如下所示：</p>
<pre><code>➜  node-example git:(master) ✗ node redis-demo.js
Reply: OK
Reply: 0
Reply: 0
2 replies:
    0: hashtest 1
    1: hashtest 2</code></pre>
<p>
Promises</p>
<p>
如果是使用node 8或者之上的话，使用node的util.promisify来将请求变成promise的。</p>
<pre><code>const {promisify}=require(&#39;util&#39;)
const redis = require(&#39;redis&#39;)
const client = redis.createClient(&#39;6379&#39;, &#39;127.0.0.1&#39;)

const getAsync=promisify(client.get).bind(client)
function getFoo(){
    return getAsync(&#39;foo&#39;).then(res =&gt; {
        console.log(res)
    })
}

getFoo()</code></pre>
<p>
发送命令</p>
<p>
每个redis命令都会通过client对象的一个函数暴露，所有这些函数都会有一个args数组选项和一个callback回调函数。</p>
<p>
字符串操作</p>
<p>
set key value</p>
<p>
get key</p>
<p>
哈希操作</p>
<p>
hmset key field1 value1</p>
<p>
hget key field1 value1</p>
<p>
列表操作</p>
<p>
lpush key value1 value2</p>
<p>
lrange key 0 n</p>
<p>
集合操作</p>
<p>
sadd key member1 member2</p>
<p>
smembers key</p>
<p>
有序集合操作</p>
<p>
zadd key index value</p>
<p>
zrange key 0 n </p>

            </article>
        </div>
    </body>
</html>

    